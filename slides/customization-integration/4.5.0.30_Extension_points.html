<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

<title>Nuxeo training - Extension points</title>

<meta name="description" content="Nuxeo - Configuration and Integration">
<meta name="author" content="Nuxeo">
<meta name="viewport" content="width=1024, user-scalable=no">

<!-- Core and extension CSS files -->
<link rel="stylesheet" href="../deck.js/core/deck.core.css">
<link rel="stylesheet" href="../deck.js/extensions/goto/deck.goto.css">
<link rel="stylesheet" href="../deck.js/extensions/menu/deck.menu.css">
<link rel="stylesheet"
  href="../deck.js/extensions/navigation/deck.navigation.css">
<link rel="stylesheet" href="../deck.js/extensions/status/deck.status.css">
<link rel="stylesheet" href="../deck.js/extensions/hash/deck.hash.css">
<link rel="stylesheet" href="../deck.js/extensions/scale/deck.scale.css">

<!-- Nuxeo Slide Default theme -->
<link rel="stylesheet"
  href="../nuxeo-slide-template/themes/style/nuxeo-theme.css">

<!-- Nuxeo Slide with comments theme -->
<link rel="stylesheet alternate" title="with comments"
  href="../nuxeo-slide-template/themes/style/nuxeo-theme-with-comments.css">

<!-- Transition theme. More available in /themes/transition/ or create your own. -->
<link rel="stylesheet"
  href="../nuxeo-slide-template/themes/transition/nuxeo-transition.css">

<script src="../deck.js/modernizr.custom.js"></script>
</head>

<body class="deck-container">

<section class="slide" id="title">
# Nuxeo training - Extension points
</section>

<section class="slide" id="wherewego-context-extension-points">
### Context <img src="img/frog-teacher.png" class="float-left" />
<blockquote><p>
Our users would appreciate to have QR codes for their books in order to get specific information about them faster. We'd better make it configurable.
</p></blockquote>
</section>

<section class="slide" id="wherewego-extension-points">
###What we want to do
####At the end of the course:
- Use external libraries to generate QR codes
- Add an extension point to our service
- The extension point will allow us to contribute QR code definitions
</section>

<section class="slide" id="extension-points-concepts">
### Extension points
#### Concepts
- Allow to configure and/or add entries to make your business logic pluggable

#### Why Use An Extension Point?
- Provides configurability: add  your own contributions
- Easy to maintain
</section>

<section class="slide" id="extension-points-howtobuild">
### Extension points
#### How To Build It?
1. <strong>Create a deserialization class</strong> (also called a <code>descriptor</code>)
  - To read the XML contributions added to your extension point
1. <strong>Update the service definition</strong>
  - To link your extension point to the descriptor
1. <strong>Update your service logic</strong>
  - To use your contributions
1. <strong>Add XML contributions</strong> and enjoy :)
</section>

<section class="slide" id="extension-points-deserialization">
### Extension points
#### Descriptor Concepts 
- Handles reading the XML contribution
- Fetches tags and their properties to map them into class attributes
- Uses specific Nuxeo annotations, called <code>XMap</code>

#### XMap annotations
- <code>@XObject("tag")</code>: <strong>Mandatory</strong>. Placed before class declaration. Fetches the root tag.
- <code>@XNode("@tag")</code>: Fetches a tag.
- <code>@XNode("property@tag")</code>: Fetches a tag's property. 
- <code>@XNodeList(value = "parentTag/childrenTags", type = String[].class, componentType = String.class)</code>: Fetches children tags of the parent tag and puts them into a String array.
- <code>@XParent("tag")</code>: Fetches a tag's parent.
</section>

<section class="slide" id="extension-points-deserialization-example">
### Extension points
#### Descriptor Example
<pre><code>&lt;?xml version="1.0"?>
&lt;component name="org.nuxeo.book.upcoming.doctype">
  &lt;extension target="org.nuxeo.ecm.core.schema.TypeService" point="doctype">
    &lt;<span style="font-weight:bold; color:orange;">doctype</span> name="Upcoming" <span style="font-weight:bold; color:green;">extends="Document"</span>>
      <span style="font-weight:bold; color:purple;">&lt;facet name="Commentable" />
      &lt;facet name="Versionable" />
      &lt;facet name="Indexable" /></span>
    &lt;/doctype>
  &lt;/extension>
&lt;/component></code></pre>

<pre><code><span style="font-weight:bold; color:orange;">@XObject("doctype")</span>
public class DocumentTypeDescriptor {
    <span style="font-weight:bold; color:green;">@XNode("@extends")</span>
    public String superTypeName;

    <span style="font-weight:bold; color:purple;">@XNodeList(value = "facet@name", type = String[].class, componentType = String.class)</span>
    public String[] facets;
}</code></pre>
</section>

<section class="slide exercise" id="exercise-descriptors">
<img src="../nuxeo-slide-template/themes/exercise.svg" alt="exercise-bk-library"
      class="exercise-icon">
### Practice
#### Descriptors

<blockquote>Our goal: have an extension point to generate QR code configurations, containing metadata separated by a specific character.</blockquote>

##### Create a Descriptor
- Given the following contribution extract, create a descriptor named <code>QrContentDescriptor</code>:
<pre><code>&lt;qrcontent id="titleVersion">
  &lt;separator value=";" />
  &lt;xpath value="dc:title" />
  &lt;xpath value="uid:major_version" />
  &lt;xpath value="uid:minor_version" />
&lt;/qrcontent></code></pre>
    
- It should map these tags to the corresponding attributes:
  - The <code>id</code> > <code>id</code> (String)
  - The <code>separator value</code> > <code>separator</code> (String)
  - The <code>xpath values</code> > <code>values</code> (String Array)
</section>

<section class="slide" id="questions-descriptors">
##Questions?
</section>

<section class="slide" id="extension-points-step2">
### Extension points
#### What's Next?
1. Create a descriptor
  - Done
1. <strong>Update the service definition</strong>
  - To link your extension point to the descriptor
1. <strong>Update your service logic</strong>
  - To use your contributions
1. <strong>Add XML contributions</strong> and enjoy :)
</section>

<section class="slide" id="extension-points-service-update">
### Extension points
#### Declaring Your Extension Point
- Your service is declared:
  - With a XML contribution
  - Located in <code>src/main/resources/OSGI-INF/extensions</code>
  - When you add it through Nuxeo IDE
- To declare an extension point:
  - Update the XML contribution
  - Use autocomplete to make things easier!
<pre><code>&lt;extension-point name="myExtensionPoint">
  &lt;object class="org.nuxeo.sample.MyDescriptorClassname" />
&lt;/extension-point></code></pre>
</section>

<section class="slide exercise" id="exercise-extension-point-declaration">
<img src="../nuxeo-slide-template/themes/exercise.svg" alt="exercise-bk-library"
      class="exercise-icon">
### Practice
#### Extension Point Declaration

<blockquote>Our goal: have an extension point to generate QR code configurations, containing metadata separated by a specific character.</blockquote>

##### Declare Your Extension Point
- Add a <code>qrcontent</code> extension point to your bestbooks service
- Link it to your <code>QrContentDescriptor</code> class
</section>

<section class="slide" id="questions-descriptors">
##Questions?
</section>

<section class="slide" id="extension-points-step2">
### Extension points
#### What's Next?
1. Create a descriptor
  - Done
1. Update the service definition
  - Done
1. <strong>Update your service logic</strong>
  - To use your contributions
1. <strong>Add XML contributions</strong> and enjoy :)
</section>

<section class="slide" id="questions-service-update">
##Questions?
</section>

<section class="slide" id="extension-points-logic">
### Extension points
#### Adding The Logic To Your Service
// TODO
</section>

<section class="slide" id="next">
### Next?
- Back to the [training agenda](0.0.1_Agenda.html#day-5)
- [Server structure](5.1.1_Nuxeo-server-structure-deployment-configuration.html)
</section>

  <!-- deck.navigation snippet -->
  <a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
  <a href="#" class="deck-next-link" title="Next">&#8594;</a>

  <!-- deck.status snippet -->
  <p class="deck-status">
    <span class="deck-status-current"></span> / <span
      class="deck-status-total"></span>
  </p>

  <!-- deck.goto snippet -->
  <form action="." method="get" class="goto-form">
    <label for="goto-slide">Go to slide:</label> <input type="text"
      name="slidenum" id="goto-slide" list="goto-datalist">
    <datalist id="goto-datalist"></datalist>
    <input type="submit" value="Go">
  </form>

  <!-- deck.hash snippet -->
  <a href="." title="Permalink to this slide" class="deck-permalink">#</a>

  <!-- Grab CDN jQuery, with a protocol relative URL; fall back to local if offline -->
  <script
    src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <!-- script>window.jQuery || document.write('<script src="../deck.js/jquery-1.7.2.min.js"><\/script>')</script -->
  <script>window.jQuery || document.write('<script src="../deck.js/jquery-1.7.2.min.js"><\/script>')</script>

  <!-- Deck Core and extensions -->
  <script src="../deck.js/core/deck.core.js"></script>
  <script src="../deck.js/extensions/hash/deck.hash.js"></script>
  <script src="../deck.js/extensions/menu/deck.menu.js"></script>
  <script src="../deck.js/extensions/goto/deck.goto.js"></script>
  <script src="../deck.js/extensions/status/deck.status.js"></script>
  <script src="../deck.js/extensions/navigation/deck.navigation.js"></script>
  <script src="../deck.js-markdown/deck.markdown.js/Markdown.Converter.js"></script>
  <script src="../deck.js-markdown/deck.markdown.js/deck.markdown.js"></script>
  <script src="../deck.js/extensions/scale/deck.scale.js"></script>
  <!-- Initialize the deck -->
  <script>
    $(function() {
       $.deck('.slide');
    });
  </script>

</body>
</html>
